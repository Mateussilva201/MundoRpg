<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ficha Genérica</title>
<link rel="icon" type="image/png" href="Logo.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');

:root {
  --bg-dark: #1a0d2e;
  --bg-panel: #27153d;
  --accent-purple: #8e44ad;
  --text-light: #f2e9ff;
  --border-highlight: #b084eb;
  --shadow: 0 0 10px rgba(142, 68, 173, 0.5);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background-color: var(--bg-dark);
  color: var(--text-light);
  font-family: 'MedievalSharp', cursive;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

header.cabecalho {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  text-align: center;
  gap: 1rem;
  border-bottom: 2px solid var(--accent-purple);
  padding-bottom: 1rem;
  margin-bottom: 2rem;
  width: 100%;
}

header .logo {
  width: 70px;
  height: auto;
}

header h1 {
  font-size: 2rem;
  color: var(--accent-purple);
  word-break: break-word;
  text-align: center;
}

main.ficha-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 1200px;
  gap: 20px;
}

.linha, .trio {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  width: 100%;
}

.card, .pericias, .combate {
  flex: 1 1 300px;
  background-color: var(--bg-panel);
  border: 1px solid var(--border-highlight);
  border-radius: 10px;
  padding: 1rem;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  transition: transform 0.3s;
  height: auto;
}
.card:hover { transform: translateY(-3px); }

.card h2, .pericias h2, .combate h2 {
  color: var(--accent-purple);
  border-bottom: 1px solid var(--border-highlight);
  padding-bottom: 4px;
  margin-bottom: 10px;
  width: 100%;
}

label {
  display: block;
  color: var(--text-light);
  margin-bottom: 8px;
  width: 100%;
  text-align: left;
}

input, textarea {
  width: 100%;
  padding: 0.5rem;
  background-color: #1a0d2e;
  border: 1px solid var(--border-highlight);
  color: var(--text-light);
  border-radius: 6px;
  margin-bottom: 0.5rem;
  font-family: 'MedievalSharp', cursive;
  font-size: 1rem;
}

textarea {
  resize: vertical;
  min-height: 120px;
}

.notas.card {
  width: 100%;
  max-width: 1200px;
}

.btn-voltar {
  display: flex;
  justify-content: center;
  margin: 30px 0;
}

.cta {
  display: flex;
  padding: 12px 30px;
  font-size: 18px;
  color: white;
  background: #6225e6;
  transition: 0.3s;
  box-shadow: 6px 6px 0 black;
  transform: skewX(-15deg);
  border: none;
  cursor: pointer;
  align-items: center;
  gap: 10px;
  border-radius: 8px;
}
.cta:hover { box-shadow: 10px 10px 0 black; }


@media (max-width: 900px) {
  header h1 { font-size: 1.7rem; }
  .linha, .trio { flex-direction: column; align-items: stretch; }
  .card, .pericias, .combate { width: 100%; }
}

@media (max-width: 600px) {
  header .logo { width: 55px; }
  .cta { font-size: 16px; padding: 10px 22px; }
  input, textarea { font-size: 0.95rem; }
  body { padding: 0.5rem; }
}

@media (max-width: 400px) {
  header h1 { font-size: 1.3rem; }
  .cta { font-size: 14px; padding: 8px 18px; }
  input, textarea { font-size: 0.9rem; }
}
</style>
</head>
<body>
<header class="cabecalho">
  <img src="Logo.png" alt="Logo Dragão" class="logo">
  <h1>Ficha de Personagem</h1>
</header>

<main class="ficha-container">
  <div class="linha">
    <section class="pericias">
      <h2>Perícias</h2>
      <label>Acrobacia (Des):<input type="number" name="pericia_acrobacia"></label>
      <label>Arcanismo (Int):<input type="number" name="pericia_arcanismo"></label>
      <label>Atuação (Car):<input type="number" name="pericia_atuacao"></label>
      <label>Enganação (Car):<input type="number" name="pericia_enganacao"></label>
      <label>Furtividade (Des):<input type="number" name="pericia_furtividade"></label>
      <label>História (Int):<input type="number" name="pericia_historia"></label>
      <label>Intimidação (Car):<input type="number" name="pericia_intimidacao"></label>
      <label>Intuição (Sab):<input type="number" name="pericia_intuicao"></label>
      <label>Investigação (Int):<input type="number" name="pericia_investigacao"></label>
      <label>Lidar com Animais (Sab):<input type="number" name="pericia_animais"></label>
      <label>Medicina (Sab):<input type="number" name="pericia_medicina"></label>
      <label>Natureza (Int):<input type="number" name="pericia_natureza"></label>
      <label>Percepção (Sab):<input type="number" name="pericia_percepcao"></label>
      <label>Persuasão (Car):<input type="number" name="pericia_persuasao"></label>
      <label>Prestidigitação (Des):<input type="number" name="pericia_prestidigitacao"></label>
      <label>Religião (Int):<input type="number" name="pericia_religiao"></label>
      <label>Sobrevivência (Sab):<input type="number" name="pericia_sobrevivencia"></label>
    </section>

    <section class="atributos card">
      <h2>Atributos</h2>
      <label>Força:<input type="number" name="forca"></label>
      <label>Destreza:<input type="number" name="destreza"></label>
      <label>Constituição:<input type="number" name="constituicao"></label>
      <label>Inteligência:<input type="number" name="inteligencia"></label>
      <label>Sabedoria:<input type="number" name="sabedoria"></label>
      <label>Carisma:<input type="number" name="carisma"></label>
    </section>

    <section class="salvaguardas card">
      <h2>Salvaguardas</h2>
      <label>Força:<input type="number" name="salva_forca"></label>
      <label>Destreza:<input type="number" name="salva_destreza"></label>
      <label>Constituição:<input type="number" name="salva_constituicao"></label>
      <label>Inteligência:<input type="number" name="salva_inteligencia"></label>
      <label>Sabedoria:<input type="number" name="salva_sabedoria"></label>
      <label>Carisma:<input type="number" name="salva_carisma"></label>
    </section>

    <section class="combate">
      <h2>Combate</h2>
      <label>Classe de Armadura:<input type="number" name="ca"></label>
      <label>Iniciativa:<input type="number" name="iniciativa"></label>
      <label>Deslocamento:<input type="number" name="deslocamento"></label>
      <label>PV Máximos:<input type="number" name="pv_max"></label>
      <label>PV Atuais:<input type="number" name="pv"></label>
      <label>PV Temporários:<input type="number" name="pv_temp"></label>
    </section>
  </div>

  <div class="trio">
    <section class="ataques card">
      <h2>Ataques & Conjuração</h2>
      <textarea name="ataques" placeholder="Ataques, magias..."></textarea>
    </section>

    <section class="equipamentos card">
      <h2>Equipamentos</h2>
      <textarea name="equipamentos" placeholder="Itens do personagem..."></textarea>
    </section>

    <section class="habilidades card">
      <h2>Características & Talentos</h2>
      <textarea name="habilidades" placeholder="Habilidades, talentos..."></textarea>
    </section>
  </div>

  <section class="notas card">
    <h2>Anotações</h2>
    <textarea name="notas" placeholder="Notas adicionais..."></textarea>
  </section>
</main>

<div class="btn-voltar">
  <button class="cta" id="baixarPDF">
     Baixar Ficha em PDF
  </button>
</div>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const fichaId = localStorage.getItem("fichaSelecionadaId");
const STORAGE_KEY = "ficha_" + fichaId;
const dadosSalvos = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

window.addEventListener("DOMContentLoaded", () => {
  const campos = document.querySelectorAll("input[name], textarea[name]");
  campos.forEach(input => {
    const nome = input.name;
    if (dadosSalvos[nome]) input.value = dadosSalvos[nome];
    input.addEventListener("input", salvarFicha);
  });
  const fichas = JSON.parse(localStorage.getItem("fichas") || "[]");
  const ficha = fichas.find(f => f.id === fichaId);
  if (ficha) {
    document.title = ficha.nome;
    const titulo = document.querySelector(".cabecalho h1");
    if (titulo) titulo.textContent = ficha.nome;
  }
});

function salvarFicha() {
  const campos = document.querySelectorAll("input[name], textarea[name]");
  const dados = {};
  campos.forEach(input => dados[input.name] = input.value);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
}

document.getElementById("baixarPDF").addEventListener("click", async () => {
  const { jsPDF } = window.jspdf;
  const botao = document.getElementById("baixarPDF");
  botao.disabled = true;
  botao.innerText = "Gerando PDF...";

  const canvas = await html2canvas(document.body, {
    scale: 2,
    useCORS: true,
    backgroundColor: "#1a0d2e"
  });

  const imgData = canvas.toDataURL("image/png");
  const pdf = new jsPDF({ orientation: "portrait", unit: "px", format: "a4" });
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  const imgWidth = pageWidth;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

  let position = 0;
  while (position < imgHeight) {
    const sliceHeight = Math.min(pageHeight, imgHeight - position);
    pdf.addImage(imgData, "PNG", 0, -position, imgWidth, imgHeight);
    position += pageHeight;
    if (position < imgHeight) pdf.addPage();
  }

  const nomeFicha = document.title || "ficha_personagem";
  pdf.save(`${nomeFicha}.pdf`);

  botao.disabled = false;
  botao.innerText = " Baixar Ficha em PDF";
});
</script>
</body>
</html>
